# T√°Ligado: GreenOn üåø‚ö°

O **GreenOn** √© uma solu√ß√£o da plataforma **T√°Ligado**, focada no gerenciamento de consumo de energia ‚ö° e emiss√µes de CO2 üåç pelas **empresas**. Ele permite monitorar e controlar o uso de energia nas filiais üè¢, identificar padr√µes e promover pr√°ticas sustent√°veis üå±, ajudando a reduzir custos üí∏ e impactos ambientais. O objetivo √© tornar as empresas mais sustent√°veis, otimizar recursos e minimizar as emiss√µes de carbono üåç.

## ‚öôÔ∏è Funcionalidades

- **Monitoramento de Consumo de Energia ‚ö°**  
  Acompanhe em tempo real o consumo de energia el√©trica nas suas filiais, com dados detalhados para cada unidade üîå.

- **Gest√£o de Emiss√µes de G√°s Carb√¥nico üåø**  
  Monitore as emiss√µes de CO2 associadas ao consumo de energia e tome a√ß√µes para reduzir o impacto ambiental üåé.

- **Cadastro de Empresas üè¢**  
  As empresas podem se cadastrar na plataforma para gerenciar suas filiais, monitorando o consumo e as emiss√µes de todas as unidades de forma centralizada.

- **Relat√≥rios e An√°lises Detalhadas üìä**  
  Obtenha relat√≥rios completos sobre o consumo de energia e as emiss√µes de gases em cada filial, ajudando a identificar padr√µes e √°reas de melhoria üìâ.

## üìö Estrutura do Banco de Dados

A aplica√ß√£o utiliza um modelo de banco de dados relacional para gerenciar as informa√ß√µes dos branch office, devices e suas intera√ß√µes. Abaixo est√° o diagrama de Entidade e Relacionamento com as tabelas principais da estrutura do banco de dados:

```mermaid
erDiagram
    DEVICE {
        NUMBER id PK
        VARCHAR2 nome
        VARCHAR2 imagemurl
        FLOAT potencia_nominal
        FLOAT tempo_uso
        FLOAT fator_emissao
        VARCHAR2 departamento
    }

    BRANCH_OFFICE {
        NUMBER id PK
        VARCHAR2 nome
        VARCHAR2 endereco
        VARCHAR2 telefone
        VARCHAR2 segmento
        FLOAT consumo_energia
        FLOAT emissoes_carbono
    }

    ROLES {
        NUMBER id PK
        VARCHAR2 role_name
    }

    USER_ENTERPRISE {
        NUMBER id PK
        VARCHAR2 nome
        VARCHAR2 username
        VARCHAR2 password
        VARCHAR2 email
        VARCHAR2 cnpj
        VARCHAR2 img_perfil
    }

    BRANCH_OFFICE_DEVICE {
        NUMBER branch_office_id FK
        NUMBER device_id FK
    }

    USER_ROLES {
        NUMBER id_user FK
        NUMBER id_role FK
    }

  BRANCH_OFFICE ||--o{ BRANCH_OFFICE_DEVICE : "possui"
    DEVICE ||--o{ BRANCH_OFFICE_DEVICE : "usa"
    USER_ENTERPRISE ||--o{ USER_ROLES : "tem"
    ROLES ||--o{ USER_ROLES : "atribui"

```
---

## üß™ Testes Unit√°rios

A aplica√ß√£o **GreenOn** inclui uma su√≠te de testes unit√°rios que garante a qualidade e o funcionamento adequado dos servi√ßos. Foram implementados testes para as classes, `UserEnterprise`, `BranchOffice`, `Device`, `UserEnterprise`, `BranchOfficeService` e `DeviceService` utilizando **JUnit** e **Mockito**. 

No total, 42 testes foram executados com sucesso, confirmando que as funcionalidades principais est√£o funcionando conforme o esperado.

![Terminal com comando `mvn clean test`](https://github.com/user-attachments/assets/bb2914bf-b746-43b0-8c5f-85de1af731db)

---
## üîë Instru√ß√µes de Acesso

> [!WARNING]  
> **üí° Observa√ß√£o:** Verifique as permiss√µes atribu√≠das a cada tipo de usu√°rio.


### üëë ADMIN padr√£o

- **Usu√°rio padr√£o (ADMIN)**:

```plaintext
Nome: Admin TaLigado
Email: admin@taligado.com
Username: admin_taligado
Imagem de Perfil: https://abrir.link/eiEEK
Senha: fiap123 (criptografada no banco)
CNPJ: 12.345.678/0001-90
Fun√ß√£o: ADMIN
```

> [!IMPORTANT]  
> **‚ö†Ô∏è Importante**: O administrador tem permiss√µes completas para gerenciar todos os aspectos do sistema, incluindo o gerenciamento de usu√°rios e dispositivos.


üßë‚Äçüíª **Acesso para Usu√°rio Padr√£o (USER)**

- **Usu√°rio padr√£o (USER)** pode criar usu√°rios comuns, como:

```plaintext
Nome: FIAP
Email: devops@fiap.com
Username: fiap@devops
Imagem de Perfil: https://abrir.link/EgrNu
Senha: fiap2024 (criptografada no banco)
CNPJ: 22.000.678/0001-90
Fun√ß√£o: USER
```

> [!NOTE]
> üìù **Aten√ß√£o:** As senhas s√£o **criptografadas** no banco de dados utilizando o algoritmo **bcrypt**. A senha fornecida acima √© a original, mas ser√° armazenada de forma segura no banco de dados.


---

## CRUD - Exemplos üìã

### 1. Criar ‚ûï

#### *Dispositivo* ‚ö°

Para criar um novo Dispositivo, voc√™ deve enviar um formul√°rio com as seguintes informa√ß√µes:

```plaintext
Nome: Monitor
Departamento: TI
Pot√™ncia Nominal: 50.0 (em watts)
Tempo de Uso: 1000.0 (em horas)
Imagem URL: https://abrir.link/ktYCA
Fator de Emiss√£o: 1 (em kgCO2/kWh)
```

#### *Filial* üè¢

Para criar uma nova filial, voc√™ pode usar o seguinte formul√°rio:

```plaintext
Nome: Filial Brasil
Endere√ßo: Rua das Industrias, 123
Telefone: 912345678
Segmento: INDUSTRIA 
Dispositivos: Monitor
```

### 2. Ler üìñ

#### *Dispositivo* üîç

Para **ler** os detalhes de um dispositivo espec√≠fico, aperte em 'Detalhes'.

#### *Filiais* üìÖ

Para **ler** os detalhes de uma filial espec√≠fica, aperte em 'Detalhes'.

### 3. Atualizar ‚úèÔ∏è

#### *Dispositivo* ‚ú®

Para **atualizar** as informa√ß√µes de um dispositivo existente, voc√™ pode enviar o seguinte formul√°rio:

```plaintext
Nome: Monitor LG
Departamento: ADMINISTRATIVO
Pot√™ncia Nominal: 35.0 (em watts)
Tempo de Uso: 1500.0 (em horas)
Imagem URL: https://abrir.link/ktYCA
Fator de Emiss√£o: 1 (em kgCO2/kWh)
```

#### *Filial* üè¢

Para **atualizar** uma filial existente, voc√™ pode usar o seguinte formul√°rio:

```plaintext
Nome: Filial Brasil
Endere√ßo: Rua dos Comercios, 123
Telefone: 1234-5678
Segmento: COMERCIO
Dispositivos: Monitor, Lampada LED
```

### 4. Excluir üóëÔ∏è

#### *Dispositivo* üõë

Para **excluir** um dispositivo, aperte em 'Excluir'.

#### *Filiais* üè†

Para **excluir** uma filial, aperte em 'Excluir'.

---

## üöÄ Deploy e Integra√ß√£o Cont√≠nua - Azure Pipelines üåêüîß

O **GreenOn** utiliza uma abordagem totalmente automatizada para **CI/CD** (Integra√ß√£o e Entrega Cont√≠nuas), aproveitando o poder do **Azure Web App** para hospedar sua aplica√ß√£o de forma escal√°vel e confi√°vel. Com o pipeline de build e release bem configurado, garantimos que o processo de desenvolvimento seja cont√≠nuo e eficiente! üí°üíª

---

### Passo a Passo para Configura√ß√£o do CI/CD üõ†Ô∏è

---

### **1Ô∏è‚É£ Cria√ß√£o do Reposit√≥rio no Azure DevOps** ‚òÅÔ∏è  
- Configure sua conta no **Azure DevOps** e crie um projeto chamado `GreenOn`. üå±
- Importe o c√≥digo-fonte do **GitHub** para o reposit√≥rio do Azure DevOps.  
- Crie as tasks iniciais para o pipeline de build.

---

### **2Ô∏è‚É£ Provisionando Infraestrutura no Azure Cloud** üèóÔ∏è  
- Crie uma conta no **Azure Cloud** e use o **Azure CLI** para provisionar:  
  - **Azure Web App** (para hospedar sua aplica√ß√£o Spring Boot).  
  - Conex√£o de servi√ßo para integra√ß√£o do DevOps com o Web App.
- Utilize automa√ß√£o com scripts para garantir uma configura√ß√£o padronizada e reutiliz√°vel. üõ°Ô∏è
  - Use o script **infraWebApp.sh** para provisionar o **Azure Web App**.
  - Salve o seguinte script como `infraWebApp.sh`:

**Script: `infraWebApp.sh`**
```bash
#!/bin/bash
# ==================== CONFIGURA√á√ÉO DO WEB APP ====================

# Vari√°veis
grupoRecursos=rg-greenon
regiao=eastus
planService=PlanGreenOn
sku=F1
appName=greenonRM552258
runtime="JAVA:17-java17" 

### Cria√ß√£o do Grupo de Recursos
# Verifica a exist√™ncia do grupo de recursos e se n√£o existir, cria
if [ $(az group exists --name $grupoRecursos) = true ]; then
    echo "O grupo de recursos $grupoRecursos j√° existe"
else
    # Cria o grupo de recursos
    az group create --name $grupoRecursos --location $regiao
    echo "Grupo de recursos $grupoRecursos criado na localiza√ß√£o $regiao"
fi

### Cria o Plano de Servi√ßo se n√£o existir
if az appservice plan show --name $planService --resource-group $grupoRecursos &> /dev/null; then
    echo "O plano de servi√ßo $planService j√° existe"
else
    az appservice plan create --name $planService --resource-group $grupoRecursos --is-linux --sku $sku
    echo "Plano de servi√ßo $planService criado com sucesso"
fi 

### Cria o Servi√ßo de Aplicativo se n√£o existir
if az webapp show --name $appName --resource-group $grupoRecursos &> /dev/null; then
    echo "O Servi√ßo de Aplicativo $appName j√° existe"
else
    az webapp create --resource-group $grupoRecursos --plan $planService --name $appName --runtime $runtime
    echo "Servi√ßo de Aplicativo $appName criado com sucesso com runtime Java 17"
fi

### Configura o Servi√ßo de Aplicativo para Java 17
if az webapp show --name $appName --resource-group $grupoRecursos > /dev/null 2>&1; then
    az webapp config set --resource-group $grupoRecursos --name $appName --java-version 17
    echo "Servi√ßo de Aplicativo $appName configurado com Java 17 com sucesso"
fi

```
- Execute:
  ```bash
  az account set --subscription "<sua_assinatura>"
  chmod +x infraWebApp.sh
  ./infraWebApp.sh > resultadoWebApp.txt
  ```

O script configura o **Web App**, o grupo de recursos e o plano de servi√ßo. Certifique-se de que todos os recursos foram criados no portal Azure.

---

### **3Ô∏è‚É£ Configura√ß√£o do Pipeline de Build (CI)** ‚öôÔ∏è  

#### Arquivo de Configura√ß√£o YAML:  
Aqui est√° um exemplo para configurar o pipeline de **build e teste** com Maven.  

```yaml
# azure-pipelines.yml
trigger:
- main

pool:
  vmImage: ubuntu-latest
  name: Azure Pipelines
  demands: maven

steps:
- task: Maven@4
  displayName: 'Executar Build e Testes com Maven'
  inputs:
    azureSubscription: '$(AzureSubscriptionID)'
    mavenPomFile: 'pom.xml'
    publishJUnitResults: true
    testResultsFiles: '**/surefire-reports/TEST-*.xml'
    testRunTitle: 'Testes do GreenOn'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '1.17'
    mavenVersionOption: 'Default'
    mavenAuthenticateFeed: false
    effectivePomSkip: false
    sonarQubeRunAnalysis: false

- task: CopyFiles@2
  displayName: 'Copiar Arquivos JAR para o Diret√≥rio de Staging'
  inputs:
    SourceFolder: '$(system.defaultworkingdirectory)'
    Contents: '**/target/*.jar'
    TargetFolder: '$(build.artifactstagingdirectory)'

- task: PublishBuildArtifacts@1
  displayName: 'Publicar Artefatos do Build'
  inputs:
    PathtoPublish: '$(build.artifactstagingdirectory)'
    ArtifactName: 'greenon-app'

```
- Esse pipeline executa os testes unit√°rios com **JUnit**, constr√≥i o pacote da aplica√ß√£o. üîß

> [!IMPORTANT]  
> **Nota: A vari√°vel `$(AzureSubscriptionID)` representa o identificador da assinatura do Azure, que √© utilizado para autentica√ß√£o e acesso seguro aos recursos da conta no Azure.** 
---

### **4Ô∏è‚É£ Configura√ß√£o do Pipeline de Release (CD)** üö¢  
- **Release Autom√°tica:** Integre o pipeline de build para que todo artefato gerado seja implantado automaticamente no **Azure Web App**.  
- **Configura√ß√µes do Web App:** Configure a aplica√ß√£o para usar as vari√°veis sens√≠veis `DB_USERNAME` e `DB_PASSWORD` encontradas no `application.properties`.  

```yaml
-spring.datasource.username=${DB_USERNAME}
-spring.datasource.password=${DB_PASSWORD}
```

> **üí° Dica:** Use o **Azure DevOps** para armazenar as vari√°veis sens√≠veis de forma segura.  

---

### **5Ô∏è‚É£ Teste do Pipeline e Deploy Manual** üß™  
- **Crie uma Release Manualmente:**  
  Realize um deploy manual inicial para validar o pipeline.  
- **Teste Funcionalidade:**  
  Certifique-se de que o Web App est√° em funcionamento e de que todas as configura√ß√µes foram aplicadas corretamente. üéâ  

---
## üåê Imagem da Aplica√ß√£o Rodando na Nuvem

Aqui est√° uma captura de tela da aplica√ß√£o **GreenOn** rodando na nuvem:

![GreenOn Rodando na Nuvem]()

---

## Tecnologias Utilizadas üõ†Ô∏è

- **Spring Boot**: Framework para desenvolvimento de aplica√ß√µes Java.
- **Thymeleaf**: Motor de templates para gerar p√°ginas HTML din√¢micas.
- **Hibernate**: ORM para mapeamento objeto-relacional.
- **Oracle Database**: Banco de dados relacional utilizado para armazenar informa√ß√µes de lookbooks e produtos.
- **JUnit**: Framework para testes unit√°rios em Java.
- **Maven**: Ferramenta de gerenciamento de depend√™ncias e build do projeto.
- **Lombok**: Reduz a verbosidade no c√≥digo Java com anota√ß√µes para gerar m√©todos autom√°ticos.
- **BCrypt**: Implementa√ß√£o de hashing para gerenciamento seguro de senhas.
- **Azure CLI**: Utilizada para criar e gerenciar Web App Service.
- **Azure DevOps**: Para configura√ß√£o de pipelines de CI/CD.

---


## üìÑ Documenta√ß√£o Adicional

- **C√≥digo Fonte**: [GitHub Repository](https://github.com/laiscrz/green-on-mvc) üìÅ
- **V√≠deo de Demonstra√ß√£o**: [YouTube Video]() üìπ

---

## ü´Ç Integrantes

Aqui est√£o os membros do grupo que participaram durante desenvolvimento desta GS.

* **RM 552258 - La√≠s Alves da Silva Cruz**
  - Turma: 2TDSPH

* **RM 552267 - Bianca Leticia Rom√°n Caldeira**
  - Turma: 2TDSPH

* **RM 552252 ‚Äì Charlene Aparecida Estevam Mendes Fialho**
  - Turma: 2TDSPH

* **RM 97916 ‚Äì Fabricio Torres Antonio**
  - Turma: 2TDSPH

* **RM 99675 ‚Äì Lucca Raphael Pereira dos Santos**
  - Turma: 2TDSPZ
    
<table>
  <tr>
      <td align="center">
      <a href="https://github.com/laiscrz">
        <img src="https://avatars.githubusercontent.com/u/133046134?v=4" width="100px;" alt="Lais Alves's photo on GitHub"/><br>
        <sub>
          <b>Lais Alves</b>
        </sub>
      </a>
      </td>
      <td align="center">
      <a href="https://github.com/biancaroman">
        <img src="https://avatars.githubusercontent.com/u/128830935?v=4" width="100px;" border-radius='50%' alt="Bianca Rom√°n's photo on GitHub"/><br>
        <sub>
          <b>Bianca Rom√°n</b>
        </sub>
      </a>
    </td>
    <td align="center">
      <a href="https://github.com/charlenefialho">
        <img src="https://avatars.githubusercontent.com/u/94643076?v=4" width="100px;" border-radius='50%' alt="Charlene Aparecida's photo on GitHub"/><br>
        <sub>
          <b>Charlene Aparecida</b>
        </sub>
      </a>
    </td>
    <td align="center">
      <a href="https://github.com/Fabs0602">
        <img src="https://avatars.githubusercontent.com/u/111320639?v=4" width="100px;" border-radius='50%' alt="Fabricio Torres's photo on GitHub"/><br>
        <sub>
          <b>Fabricio Torres</b>
        </sub>
      </a>
    </td>
    <td align="center">
      <a href="https://github.com/LuccaRaphael">
        <img src="https://avatars.githubusercontent.com/u/127765063?v=4" width="100px;" border-radius='50%' alt="Lucca Raphael's photo on GitHub"/><br>
        <sub>
          <b>Lucca Raphael</b>
        </sub>
      </a>
    </td>
  </tr>
</table>

---

> Esse guia detalha o processo de configura√ß√£o do CI/CD, desde a cria√ß√£o do projeto no Azure at√© a configura√ß√£o do pipeline de build e release, facilitando a automa√ß√£o do deploy e a entrega cont√≠nua da aplica√ß√£o **GreenOn**. ‚ú®üöÄ
